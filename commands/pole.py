#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ò–≥—Ä–∞ "–ü–æ–ª–µ —á—É–¥–µ—Å" - –∫–æ–º–∞–Ω–¥–∞ /pole
"""

import os
import random
import asyncio
from telegram import Update
from telegram.ext import ContextTypes

# –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –¥–ª—è –∏–≥—Ä—ã –≤ "–ü–æ–ª–µ —á—É–¥–µ—Å"
pole_words = [
    "–∫—Ä—ã—à–∞", "–æ–∫–Ω–æ", "–¥–≤–µ—Ä—å", "—Å—Ç–µ–Ω–∞", "–ø–æ–ª", "–ø–æ—Ç–æ–ª–æ–∫", "–ª–µ—Å—Ç–Ω–∏—Ü–∞", "–±–∞–ª–∫–æ–Ω",
    "–ø–æ–¥—ä–µ–∑–¥", "–ª–∏—Ñ—Ç", "–∫–≤–∞—Ä—Ç–∏—Ä–∞", "–¥–æ–º", "–¥–∞—á–∞", "–≥–∞—Ä–∞–∂", "—Å–∞—Ä–∞–π", "–±–∞–Ω—è",
    "–±–∞—Å—Å–µ–π–Ω", "—Å–ø–æ—Ä—Ç–∑–∞–ª", "–∫—É—Ö–Ω—è", "–≤–∞–Ω–Ω–∞—è", "—Å–ø–∞–ª—å–Ω—è", "–≥–æ—Å—Ç–∏–Ω–∞—è", "–∫–æ—Ä–∏–¥–æ—Ä",
    "–∫–ª–∞–¥–æ–≤–∫–∞", "—á–µ—Ä–¥–∞–∫", "–ø–æ–¥–≤–∞–ª", "—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç", "–∫—Ä—ã–ª—å—Ü–æ", "—Ç–µ—Ä—Ä–∞—Å–∞", "–≤–µ—Ä–∞–Ω–¥–∞",
    "–∞–Ω–∞–Ω–∞—Å", "–±–∞–Ω–∞–Ω", "–≤–∏–Ω–æ–≥—Ä–∞–¥", "–≥—Ä—É—à–∞", "–¥—ã–Ω—è", "–µ–∂–µ–≤–∏–∫–∞", "–∂–∞—Å–º–∏–Ω", "–∑–µ–º–ª—è–Ω–∏–∫–∞", "–∏–º–±–∏—Ä—å", "–π–æ–≥—É—Ä—Ç",
    "–∫–∏–≤–∏", "–ª–∏–º–æ–Ω", "–º–∞–Ω–≥–æ", "–Ω–µ–∫—Ç–∞—Ä–∏–Ω", "–æ–≥—É—Ä–µ—Ü", "–ø–µ—Ä–µ—Ü", "—Ä–µ–¥–∏—Å", "—Å–ª–∏–≤–∞", "—Ç—ã–∫–≤–∞", "—É–∫—Ä–æ–ø",
    "—Ñ–µ–Ω—Ö–µ–ª—å", "—Ö—É—Ä–º–∞", "—Ü—É–∫–∏–Ω–∏", "—á–µ—Ä–µ—à–Ω—è", "—à–ø–∏–Ω–∞—Ç", "—â–∞–≤–µ–ª—å", "—ç—Å—Ç—Ä–∞–≥–æ–Ω", "—é–∫–∫–∞", "—è–±–ª–æ–∫–æ", "–∞–±—Ä–∏–∫–æ—Å",
    "–±–∞–∫–ª–∞–∂–∞–Ω", "–≤–∞–Ω–∏–ª—å", "–≥—Ä–∞–Ω–∞—Ç", "–¥—É—Ä–∏–∞–Ω", "–µ–∂–µ–≤–∏–∫–∞", "–∂–µ–Ω—å—à–µ–Ω—å", "–∑–µ–ª–µ–Ω—ã–π", "–∏—Ä–≥–∞", "–π–æ–≥—É—Ä—Ç", "–∫–æ–∫–æ—Å",
    "–ª–∞–π–º", "–º–∞–Ω–¥–∞—Ä–∏–Ω", "–Ω—É—Ç", "–æ–ª–∏–≤–∫–∞", "–ø–µ—Ç—Ä—É—à–∫–∞", "—Ä–µ–≤–µ–Ω—å", "—Å–µ–ª—å–¥–µ—Ä–µ–π", "—Ç–∏–º—å—è–Ω", "—É—Å—Ç—Ä–∏—Ü–∞", "—Ñ–∏–Ω–∏–∫",
    "—Ö—Ä–µ–Ω", "—Ü–∏–∫–æ—Ä–∏–π", "—á–µ—Å–Ω–æ–∫", "—à–∞–ª—Ñ–µ–π", "—â–∞–≤–µ–ª—å", "—ç—Ö–∏–Ω–∞—Ü–µ—è", "—é–∫–∫–∞", "—è–≥–æ–¥–∞", "–∞–π–≤–∞", "–±—Ä–æ–∫–∫–æ–ª–∏",
    "–≤–∞—Å–∞–±–∏", "–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç", "–¥—ã–Ω—è", "–µ–∂–µ–≤–∏–∫–∞", "–∂–∞—Å–º–∏–Ω", "–∑–µ–º–ª—è–Ω–∏–∫–∞", "–∏–º–±–∏—Ä—å", "–π–æ–≥—É—Ä—Ç", "–∫–∏–≤–∏", "–ª–∏–º–æ–Ω",
    "–º–∞–Ω–≥–æ", "–Ω–µ–∫—Ç–∞—Ä–∏–Ω", "–æ–≥—É—Ä–µ—Ü", "–ø–µ—Ä–µ—Ü", "—Ä–µ–¥–∏—Å", "—Å–ª–∏–≤–∞", "—Ç—ã–∫–≤–∞", "—É–∫—Ä–æ–ø", "—Ñ–µ–Ω—Ö–µ–ª—å", "—Ö—É—Ä–º–∞",
    "—Ü—É–∫–∏–Ω–∏", "—á–µ—Ä–µ—à–Ω—è", "—à–ø–∏–Ω–∞—Ç", "—â–∞–≤–µ–ª—å", "—ç—Å—Ç—Ä–∞–≥–æ–Ω", "—é–∫–∫–∞", "—è–±–ª–æ–∫–æ", "–∞–±—Ä–∏–∫–æ—Å", "–±–∞–∫–ª–∞–∂–∞–Ω", "–≤–∞–Ω–∏–ª—å",
    "–≥—Ä–∞–Ω–∞—Ç", "–¥—É—Ä–∏–∞–Ω", "–µ–∂–µ–≤–∏–∫–∞", "–∂–µ–Ω—å—à–µ–Ω—å", "–∑–µ–ª–µ–Ω—ã–π", "–∏—Ä–≥–∞", "–π–æ–≥—É—Ä—Ç", "–∫–æ–∫–æ—Å", "–ª–∞–π–º", "–º–∞–Ω–¥–∞—Ä–∏–Ω",
    "–Ω—É—Ç", "–æ–ª–∏–≤–∫–∞", "–ø–µ—Ç—Ä—É—à–∫–∞", "—Ä–µ–≤–µ–Ω—å", "—Å–µ–ª—å–¥–µ—Ä–µ–π", "—Ç–∏–º—å—è–Ω", "—É—Å—Ç—Ä–∏—Ü–∞", "—Ñ–∏–Ω–∏–∫", "—Ö—Ä–µ–Ω", "—Ü–∏–∫–æ—Ä–∏–π",
    "—á–µ—Å–Ω–æ–∫", "—à–∞–ª—Ñ–µ–π", "—â–∞–≤–µ–ª—å", "—ç—Ö–∏–Ω–∞—Ü–µ—è", "—é–∫–∫–∞", "—è–≥–æ–¥–∞", "–∞–π–≤–∞", "–±—Ä–æ–∫–∫–æ–ª–∏", "–≤–∞—Å–∞–±–∏", "–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç"
]

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
pole_games = {}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
async def send_random_voice(bot, chat_id, folder, prefix, count):
    try:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–æ–º–µ—Ä
        number = random.randint(1, count)
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
        voice_path = f"{folder}/{prefix}_{number}.mp3"
        
        if os.path.exists(voice_path):
            with open(voice_path, 'rb') as voice:
                await bot.send_voice(chat_id, voice)
            print(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {voice_path}")
        else:
            print(f"–§–∞–π–ª –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω: {voice_path}")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
def create_pole_game():
    word = random.choice(pole_words)
    guessed_letters = set()
    used_letters = set()
    return {
        'word': word,
        'guessed_letters': guessed_letters,
        'used_letters': used_letters
    }

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ª–æ–≤–∞
def display_word(word, guessed_letters):
    return ' '.join(letter if letter in guessed_letters else '_' for letter in word)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—É–∫–≤
def display_available_letters(used_letters):
    alphabet = '–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è'
    return ' '.join(letter if letter not in used_letters else '~~' + letter + '~~' for letter in alphabet)

async def pole_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /pole"""
    msg = update.effective_message
    chat = update.effective_chat
    chat_id = chat.id if chat else None
    user_id = update.effective_user.id
    chat_type = update.effective_chat.type
    
    print(f"üîç POLE COMMAND DEBUG: /pole –∑–∞–ø—É—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id} –≤ —á–∞—Ç–µ {chat_id}, —Ç–∏–ø —á–∞—Ç–∞: {chat_type}")
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ –∏–≥—Ä–µ "–ü–æ–ª–µ —á—É–¥–µ—Å" –≤ —ç—Ç–æ–º —á–∞—Ç–µ, —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –ø–æ–ø—ã—Ç–∫–æ–π —É–≥–∞–¥–∞—Ç—å
    if user_id in pole_games and pole_games[user_id]['chat_id'] == chat_id:
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} —É–∂–µ –≤ –∏–≥—Ä–µ –≤ —á–∞—Ç–µ {chat_id}. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –ø–æ–ø—ã—Ç–∫—É —É–≥–∞–¥–∞—Ç—å.")
        # –ü–µ—Ä–µ–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ handle_pole_message
        await handle_pole_message(update, context)
        return

    print(f"–ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É –ü–æ–ª–µ —á—É–¥–µ—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –≤ —á–∞—Ç–µ {chat_id}")
    # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º chat_id
    game_state = create_pole_game()
    game_state['chat_id'] = chat_id
    game_state['bot_message_ids'] = [] # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ ID —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞
    pole_games[user_id] = game_state
    # Debug removed
    game = pole_games[user_id]
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—è —á—É–¥–µ—Å –∫–∞–∫ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    image_path = 'images/pole.png'
    if os.path.exists(image_path):
        with open(image_path, 'rb') as photo:
            if msg:
                await msg.reply_photo(photo, reply_to_message_id=msg.message_id)
        print(f"–ö–∞—Ä—Ç–∏–Ω–∫–∞ {image_path} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /pole –∫–∞–∫ –æ—Ç–≤–µ—Ç.")
    else:
        print(f"–§–∞–π–ª –∫–∞—Ä—Ç–∏–Ω–∫–∏ {image_path} –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /pole. –û—Ç–ø—Ä–∞–≤–ª—è—é —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç.")

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∫ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    word_display = display_word(game['word'], game['guessed_letters'])
    letters_display = display_available_letters(game['used_letters'])

    response = (
        f"üéØ –ò–≥—Ä–∞ '–ü–æ–ª–µ —á—É–¥–µ—Å' –Ω–∞—á–∞–ª–∞—Å—å!\n\n"
        f"–°–ª–æ–≤–æ: {word_display}\n\n"
        f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –±—É–∫–≤—ã:\n{letters_display}\n\n"
        f"–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±—É–∫–≤—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≥–∞–¥–∞—Ç—å —Å–ª–æ–≤–æ —Ü–µ–ª–∏–∫–æ–º!"
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ message_id –∫–∞–∫ initial_message_id
    initial_message = await msg.reply_text(response, parse_mode='HTML') if msg else None
    if initial_message:
        pole_games[user_id]['bot_message_ids'].append(initial_message.message_id) # –î–æ–±–∞–≤–ª—è–µ–º ID –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        pole_games[user_id]['initial_message_id'] = initial_message.message_id
        print(f"–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –≤ —á–∞—Ç–µ {chat_id} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ initial_message_id: {initial_message.message_id}")

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è
    await send_random_voice(context.bot, chat_id, 'pole', 'wait', 3)

async def handle_pole_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏–≥—Ä–µ –ü–æ–ª–µ —á—É–¥–µ—Å"""
    user_id = update.effective_user.id
    msg = update.effective_message
    chat = update.effective_chat
    if not chat or not msg:
        return
    chat_id = chat.id
    
    # Debug removed
    
    # –ò—â–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∏–≥—Ä—É –≤ —ç—Ç–æ–º —á–∞—Ç–µ
    active_game = None
    game_owner = None
    
    for owner_id, game in pole_games.items():
        if game['chat_id'] == chat_id:
            active_game = game
            game_owner = owner_id
            break
    
    if not active_game:
        return # –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ
    
    game = active_game

    guess = msg.text.lower().strip() if (msg and msg.text) else ''
    print(f"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ —Ö–æ–¥ –≤ –ü–æ–ª–µ —á—É–¥–µ—Å. –£–≥–∞–¥—ã–≤–∞–Ω–∏–µ: {guess}")

    # –ï—Å–ª–∏ guess –ø—É—Å—Ç–æ–π –ø–æ—Å–ª–µ –æ–±—Ä–µ–∑–∫–∏
    if not guess:
        response = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –±—É–∫–≤—É –∏–ª–∏ —Å–ª–æ–≤–æ –¥–ª—è —É–≥–∞–¥—ã–≤–∞–Ω–∏—è."
        await msg.reply_text(response)
        return # –í—ã—Ö–æ–¥–∏–º, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –ø—É—Å—Ç–æ–π –≤–≤–æ–¥

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –±–æ—Ç –¥—É–º–∞–µ—Ç
    thinking_msg = await msg.reply_text("ü§î –î—É–º–∞—é...")
    game['bot_message_ids'].append(thinking_msg.message_id) # –î–æ–±–∞–≤–ª—è–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏—è "–î—É–º–∞—é..."
    
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ "—Ä–∞–∑–¥—É–º–∏–π"
    await asyncio.sleep(1)
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —É–≥–∞–¥–∞—Ç—å —Å–ª–æ–≤–æ —Ü–µ–ª–∏–∫–æ–º
    if len(guess) > 1:
        if guess == game['word']:
            response = (
                f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É–≥–∞–¥–∞–ª–∏ —Å–ª–æ–≤–æ '{game['word']}'!\n"
                f"–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /pole"
            )
            del pole_games[game_owner]
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–±–µ–¥—ã –∫–∞–∫ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
            try:
                with open('pole/win.mp3', 'rb') as voice:
                    await context.bot.send_voice(chat_id, voice, reply_to_message_id=msg.message_id)
                print("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–±–µ–¥—ã: pole/win.mp3")
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–±–µ–¥—ã: {e}")
        else:
            response = "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ —Å–ª–æ–≤–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —É–≥–∞–¥—ã–≤–∞—Ç—å –±—É–∫–≤—ã."
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            await send_random_voice(context.bot, chat_id, 'pole', 'no', 3)
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —É–≥–∞–¥–∞—Ç—å –±—É–∫–≤—É
    elif len(guess) == 1 and guess.isalpha():
        if guess in game['used_letters']:
            response = "–≠—Ç–∞ –±—É–∫–≤–∞ —É–∂–µ –±—ã–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!"
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            await send_random_voice(context.bot, chat_id, 'pole', 'no', 3)
        else:
            game['used_letters'].add(guess)
            if guess in game['word']:
                game['guessed_letters'].add(guess)
                response = "‚úÖ –í–µ—Ä–Ω–æ! –ë—É–∫–≤–∞ –µ—Å—Ç—å –≤ —Å–ª–æ–≤–µ."
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–µ—Ä–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                await send_random_voice(context.bot, chat_id, 'pole', 'yes', 3)
            else:
                response = "‚ùå –ù–µ–≤–µ—Ä–Ω–æ! –¢–∞–∫–æ–π –±—É–∫–≤—ã –Ω–µ—Ç –≤ —Å–ª–æ–≤–µ."
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                await send_random_voice(context.bot, chat_id, 'pole', 'no', 3)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–≥–∞–¥–∞–Ω–æ –ª–∏ –≤—Å—ë —Å–ª–æ–≤–æ
            if all(letter in game['guessed_letters'] for letter in game['word']):
                response = (
                    f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É–≥–∞–¥–∞–ª–∏ —Å–ª–æ–≤–æ '{game['word']}'!\n"
                    f"–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /pole"
                )
                del pole_games[game_owner]
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–±–µ–¥—ã –∫–∞–∫ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
                try:
                    with open('pole/win.mp3', 'rb') as voice:
                        await context.bot.send_voice(chat_id, voice, reply_to_message_id=msg.message_id)
                    print("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–±–µ–¥—ã: pole/win.mp3")
                except Exception as e:
                    print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–±–µ–¥—ã: {e}")
            else:
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
                word_display = display_word(game['word'], game['guessed_letters'])
                letters_display = display_available_letters(game['used_letters'])
                response += f"\n\n–°–ª–æ–≤–æ: {word_display}\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –±—É–∫–≤—ã:\n{letters_display}"
    else:
        response = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–¥–Ω—É –±—É–∫–≤—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≥–∞–¥–∞—Ç—å —Å–ª–æ–≤–æ —Ü–µ–ª–∏–∫–æ–º."
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        await send_random_voice(context.bot, chat_id, 'pole', 'no', 3)
    
    # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–î—É–º–∞—é..."
    await context.bot.delete_message(chat_id, thinking_msg.message_id)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
    response_message = await msg.reply_text(response, parse_mode='HTML')
    game['bot_message_ids'].append(response_message.message_id) # –î–æ–±–∞–≤–ª—è–µ–º ID –æ—Ç–≤–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
